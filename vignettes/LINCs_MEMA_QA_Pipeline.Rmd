---
title: "Population QA Pipeline"
author: "Mark Dane"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Population QA Pipeline}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

##Introduction
This vignette demonstrates and explains the MEMA QA pipeline that is based on populaton-level data.

[explanation of LINCs, MEMAs and the Tecan]



```{r setup, echo=FALSE, message=FALSE}
library("ggplot2")
library("data.table")
library("MEMA")

numericMedian <- function(x) as.numeric(median(x))

popDT <- MEMA::popDT

barcodes <- sort(unique(popDT$Barcode))

# Clean up the dataset that will be used in the analysis
popDT <- popDT[!popDT$ShortName =="blank"]
popDT$ShortName <- gsub("blank","",popDT$ShortName)
setnames(popDT,"Ligand","LigandAnnotID")
ms <- gregexpr("^[[:alnum:]]*[^_]", popDT$LigandAnnotID)
popDT$Ligand <- unlist(regmatches(popDT$LigandAnnotID, ms))

```


##MEMA Layout
The LINCs MEMA has 46 ECM proteins spotted in 35 rows and 20 columns. The proteins are randomly assigned to the top 30 rows of spots. Rows 31-35 are replicates of rows 1-5. The upper left and bottom right corners are image fiducials in the 488nm channel and there are four blank spots for checking orientation in all channels.



```{r Content Layout,echo=FALSE, message=FALSE, warnings=FALSE, fig.width=8,fig.height=5}
#Select only one type of array to display and show the  pattern
DT <- popDT[,list(Block,Position,ShortName,Name,ID,ArrayRow,ArrayColumn),keyby=Well]
DT <- DT["A01",]
DT <- unique(DT,by=NULL)

p <- ggplot(DT,aes(x = ArrayColumn, y = ArrayRow, fill=ShortName))+
  geom_point(shape=21, size = 2.2)+
  #scale_colour_manual(values=c("black", "white"))+
    guides(fill=guide_legend(ncol = 4))+guides( colour = FALSE )+
  theme(legend.text = element_text(size = rel(.5)),legend.title=element_text(size = rel(.5)),plot.title=element_text(size = rel(.8))
       # , plot.margin = unit(c(2, 0.5, 1, 1), "in")
        )+
  scale_y_reverse()+
  xlab("")+ylab("")+
  ggtitle("LINCs ECM A Row Layout")
print(p)

```
